From fc9b03f3e8fa20b5f9249f46e99b45162c7e1626 Mon Sep 17 00:00:00 2001
From: William Woodall <william@osrfoundation.org>
Date: Mon, 21 Sep 2015 14:19:55 -0700
Subject: [PATCH 7/9] fix compiling on OS X

---
 CMakeLists.txt        | 6 +++++-
 stage-config.cmake.in | 2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index ffd6cc1..962d848 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -156,7 +156,11 @@ CONFIGURE_FILE (${CMAKE_CURRENT_SOURCE_DIR}/stage.pc.in ${CMAKE_CURRENT_BINARY_D
 INSTALL (FILES ${CMAKE_CURRENT_BINARY_DIR}/stage.pc DESTINATION ${PROJECT_LIB_DIR}/pkgconfig/)
 
 # Create the CMake module files
-CONFIGURE_FILE (${CMAKE_CURRENT_SOURCE_DIR}/stage-config.cmake.in ${CMAKE_CURRENT_BINARY_DIR}/stage-config.cmake @ONLY)
+CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/stage-config.cmake.in ${CMAKE_CURRENT_BINARY_DIR}/stage-config.cmake @ONLY)
+# Also run it through file(GENERATE ...) to expand generator expressions.
+FILE (GENERATE
+  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/stage-config.cmake
+  INPUT ${CMAKE_CURRENT_BINARY_DIR}/stage-config.cmake)
 CONFIGURE_FILE (${CMAKE_CURRENT_SOURCE_DIR}/stage-config-version.cmake.in ${CMAKE_CURRENT_BINARY_DIR}/stage-config-version.cmake @ONLY)
 INSTALL (FILES ${CMAKE_CURRENT_BINARY_DIR}/stage-config.cmake ${CMAKE_CURRENT_BINARY_DIR}/stage-config-version.cmake DESTINATION ${PROJECT_LIB_DIR}/cmake/${PROJECT_NAME})
 
diff --git a/stage-config.cmake.in b/stage-config.cmake.in
index 6bf3f71..6b60ce6 100644
--- a/stage-config.cmake.in
+++ b/stage-config.cmake.in
@@ -8,7 +8,7 @@ set(STAGE_INCLUDE_DIRS "@CMAKE_INSTALL_PREFIX@/include/@PROJECT_NAME@-@APIVERSIO
   "@OPENGL_INCLUDE_DIR@")
 list(REMOVE_DUPLICATES STAGE_INCLUDE_DIRS)
 set(STAGE_LIBRARIES 
-  "@CMAKE_INSTALL_PREFIX@/@PROJECT_LIB_DIR@/libstage.so"
+  "$<TARGET_FILE:stage>"
   "@FLTK_LIBRARIES@"
   "@OPENGL_gl_LIBRARIES@")
   
-- 
2.9.0

